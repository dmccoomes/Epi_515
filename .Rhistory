<<<<<<< HEAD
=======
knitr::opts_chunk$set(include=TRUE, echo = TRUE)
#install.packages("devtools", dependencies = TRUE, repos = "http://cran.us.r-project.org")
library(devtools)
#install_github("bmckuw/UWbe536")
library(ggplot2)
library(lmtest)
library(beeswarm)
library(data.table)
library(tidyverse)
library(UWbe536)
>>>>>>> c0a3c175c5a48070e775b5f4972beb0cbf30a491
knitr::opts_chunk$set(echo = TRUE)
library(foreign)
library(haven)
library(stats)
library(tidyr)
library(reshape2)
library(psych)
<<<<<<< HEAD
=======
link="https://github.com/dmccoomes/Epi_515/raw/master/epi515_missing_data_analysis.dta"
miss <- read_dta(url(link))
install.packages("psych")
propmiss <- function(dataframe) {
m<-sapply(dataframe, function(x) {
data.frame(
nmiss=sum(is.na(x)),
n=length(x),
propmiss=sum(is.na(x))/length(x)
)
})
d <- data.frame(t(m))
d <- sapply(d, unlist)
d <- as.data.frame(d)
d$variable <- row.names(d)
row.names(d) <- NULL
d <- cbind(d[ncol(d)],d[-ncol(d)])
return(d[order(d$propmiss), ])
}
propmiss(miss.wide)
link="https://github.com/dmccoomes/Epi_515/raw/master/epi528_missing_data_analysis_WIDE.dta"
miss.wide <- read_dta(url(link))
link="https://github.com/dmccoomes/Epi_515/raw/master/epi528_missing_data_analysis_WIDE.dta"
miss.wide <- read_dta(url(link))
library(foreign)
library(haven)
library(stats)
library(tidyr)
library(reshape2)
library(psych)
>>>>>>> c0a3c175c5a48070e775b5f4972beb0cbf30a491
install.packages("psych")
library(foreign)
library(haven)
library(stats)
library(tidyr)
library(reshape2)
library(psych)
link="https://github.com/dmccoomes/Epi_515/raw/master/epi528_missing_data_analysis_WIDE.dta"
miss.wide <- read_dta(url(link))
<<<<<<< HEAD
summary(is.na(miss.wide))
miss.wide[!complete.cases(miss.wide),]
#dummy var for missing data
miss.wide$exp_miss <- ifelse(is.na(miss.wide$cd4cnt_ph1), 1, 0)
miss.wide$out_miss <- ifelse(is.na(miss.wide$oi1), 1, 0)
miss.wide$income_miss <- ifelse(is.na(miss$income), 1, 0)
describe.by(miss.wide, miss.wide$out_miss)
miss.wide$out_miss <- ifelse(is.na(miss.wide$oi4), 1, 0)
describe.by(miss.wide, miss.wide$out_miss)
describe(miss.wide)
summary(miss.wide$exp_miss)
describe.by(miss.wide$residence, miss.wide$exp_miss)
describe.by(miss.wide$exp_miss, miss.wide$residence)
describe.by(miss.wide$residence, miss.wide$exp_miss)
describe.by(miss.wide$exp_miss, miss.wide$residence)
miss.wide$res_0_5 <- ifelse(miss.wide$residence==0, 1, 0)
miss.wide$res_5_10 <- ifelse(miss.wide$residence==1, 1, 0)
miss.wide$res_10_up <- ifelse(miss.wide$residence==2, 1, 0)
describe.by(miss.wide, miss.wide$exp_miss)
describe.by(miss.wide, miss.wide$out_miss)
describe(miss.wide)
model.1 <- glm(oi4~cd4cnt_ph1, data=miss.wide, family=binomial)
summary(model.1)
model.2 <- glm(oi4~cd4cnt_ph1+art_base+septrin4+cd4cnt_ph4+site+income+sex+age+residence+activity, data=miss.wide, family=binomial)
model.2 <- glm(oi4~cd4cnt_ph1+art_base+septrin4+cd4cnt_ph4+site+income+sex+age+residence, data=miss.wide, family=binomial)
model.2 <- glm(oi4~cd4cnt_ph1+art_base+septrin4+site+income+sex+age+residence+activity, data=miss.wide, family=binomial)
model.2 <- glm(oi4~cd4cnt_ph1+art_base+septrin4+site+income+sex+age+residence, data=miss.wide, family=binomial)
model.2 <- glm(oi4~cd4cnt_ph1+septrin4+site+income+sex+age+residence, data=miss.wide, family=binomial)
model.2 <- glm(oi4~cd4cnt_ph1+septrin4+site+income+sex+residence, data=miss.wide, family=binomial)
model.2 <- glm(oi4~cd4cnt_ph1+septrin4+site+income+residence, data=miss.wide, family=binomial)
summary(model.2)
model.3 <- glm(oi4~cd4cnt_ph1+septrin4, data=miss.wide, family=binomial)
summary(model.3)
lincom(model.2)
library(UWbe536)
lincom(model.2)
model.3 <- glm(oi4~cd4cnt_ph1+septrin4, data=miss.wide, family=binomial)
lincom(model.3)
model.4 <- glm(oi4~cd4cnt_ph1+art_base+septrin4+site+income+sex+age+residence, data=miss.wide, family=binomial)
model.3 <- glm(oi4~cd4cnt_ph1+septrin4+art_base, data=miss.wide, family=binomial)
lincom(model.3)
miss.wide$residence <- as.factor(miss.wide$residence)
?mice
install.packages("mice")
library(mice)
?mice
names(miss.wide)
names(miss.wide)
var<-c(2:14)
mice_vars <- miss.wide[,var]
names(mice_vars)
mice <- mice(mice_vars[1:13], m=10, maxit=50, seed=135, method=method)
method <- c("logreg", "norm.nob", "logreg", "logreg", "norm.nob", "logreg", "logreg", "logreg", "norm.nob", "norm.nob", "norm.nob", "polyreg", "logreg")
mice <- mice(mice_vars[1:13], m=10, maxit=50, seed=135, method=method)
View(miss.data)
View(miss.wide)
miss.wide$residence <- as.factor(miss.wide$residence)
miss.wide$site <- as.factor(miss.wide$site)
miss.wide$sex <- as.factor(miss.wide$sex)
miss.wide$art_base <- as.factor(miss.wide$art_base)
miss.wide$septrin1 <- as.factor(miss.wide$septrin1)
miss.wide$septrin4 <- as.factor(miss.wide$septrin4)
miss.wide$oi1 <- as.factor(miss.wide$oi1)
miss.wide$oi4 <- as.factor(miss.wide$oi4)
names(miss.wide)
var<-c(2:14)
mice_vars <- miss.wide[,var]
names(mice_vars)
method <- c("logreg", "norm.nob", "logreg", "logreg", "norm.nob", "logreg", "logreg", "logreg", "norm.nob", "norm.nob", "norm.nob", "polyreg", "logreg")
mice <- mice(mice_vars[1:13], m=10, maxit=50, seed=135, method=method)
summary(mice)
mice6<-complete(mice, 6)
View(mice6)
imputed.model.mice <- glm.mids(formula=oi4~cd4cnt_ph1+art_base+septrin4+septrin1+sex+age+income+residence+activity+cd4cnt_ph4+oi1, data=mice, family=binomial)
imputed.model.mice <- glm.mids(formula=oi4~cd4cnt_ph1+art_base+septrin4+sex+age+income+residence+cd4cnt_ph4+oi1, data=mice, family=binomial)
imputed.model.mice <- glm.mids(formula=oi4~cd4cnt_ph1+art_base+septrin4+sex+income+residence+cd4cnt_ph4+oi1, data=mice, family=binomial)
imputed.model.mice <- glm.mids(formula=oi4~cd4cnt_ph1+art_base+septrin4+income+residence+cd4cnt_ph4+oi1, data=mice, family=binomial)
imputed.model.mice <- glm.mids(formula=oi4~cd4cnt_ph1+art_base+septrin4+residence+cd4cnt_ph4+oi1, data=mice, family=binomial)
imputed.model.mice <- glm.mids(formula=oi4~cd4cnt_ph1+art_base+septrin4+residence+cd4cnt_ph4, data=mice, family=binomial)
imputed.model.mice <- glm.mids(formula=oi4~cd4cnt_ph1+art_base+septrin4+residence, data=mice, family=binomial)
imputed.model.mice <- glm.mids(formula=oi4~cd4cnt_ph1+art_base+septrin4, data=mice, family=binomial)
imputed.model.mice <- glm.mids(formula=oi4~cd4cnt_ph1+art_base+septrin4+income, data=mice, family=binomial)
imputed.model.mice <- glm.mids(formula=oi4~cd4cnt_ph1+art_base+septrin4+income+site, data=mice, family=binomial)
imputed.model.mice <- glm.mids(formula=oi4~cd4cnt_ph1+art_base+septrin4+income+site+age, data=mice, family=binomial)
imputed.model.mice <- glm.mids(formula=oi4~cd4cnt_ph1+art_base+septrin4+income+site+age+sex, data=mice, family=binomial)
imputed.model.mice <- glm.mids(formula=oi4~cd4cnt_ph1+art_base+septrin4+income+site+sex, data=mice, family=binomial)
imputed.model.mice <- glm.mids(formula=oi4~cd4cnt_ph1+art_base+septrin4+income+site+age, data=mice, family=binomial)
pool <- pool(imputed.model.mice)
summary(pool)
lincom(pool)
e^-2.27136014
a<- e^-2.27136014
a <- exp(-2.2713604)
a
OR_low <- exp(pool[2,1])
OR_low <- exp(pool[,2])
OR_low
OR_low <- exp(pool[2,])
model.3 <- glm(oi4~cd4cnt_ph1+septrin4+art_base, data=miss.wide, family=binomial)
summary(model.3)
lincom(model.3)
summary(pool)
OR <- exp(-2.2713604)
OR_low <- exp(-2.2713604 - 2*0.99259718)
OR_high <- exp(-2.2713604 + 2*0.99259718)
OR
OR_low
OR_high
model.4 <- glm(oi4~cd4cnt_ph1+art_base+septrin4+site+income+sex+age+residence, data=miss.wide, family=binomial)
model.3 <- glm(oi4~cd4cnt_ph1+septrin4+art_base, data=miss.wide, family=binomial)
lincom(model.3)
OR
OR_low
OR_high
disperse(pool, dims=1)
compare.density(pool, var="oi1")
install.packages("mi")
library(mi)
compare.density(pool, var="oi1")
plot(mice)
densityplot(mice)
model.5 <- glm(oi4~cd4cnt_ph1+septrin4+art_base+site+sex+age+residence, data=miss.wide, family=binomial)
imputed.model.mice <- glm.mids(formula=oi4~cd4cnt_ph1+art_base+septrin4+income+site+age+site:cd4cnt_ph1, data=mice, family=binomial)
imputed.model.mice <- glm.mids(formula=oi4~cd4cnt_ph1+art_base+septrin4+income+site+age, data=mice, family=binomial)
pool <- pool(imputed.model.mice)
pool <- pool(imputed.model.mice, data=miss.wide)
summary(pool)
pool <- pool(imputed.model.mice)
summary(pool)
OR <- exp(-2.2713604)
OR_low <- exp(-2.2713604 - 2*0.99259718)
OR_high <- exp(-2.2713604 + 2*0.99259718)
OR
OR_low
OR_high
describe.by(miss.wide, miss.wide$cd4cnt_ph1)
describe.by(miss.wide, miss.wide$oi4)
describe.by(miss.wide, miss.wide$oi4)
link="https://github.com/dmccoomes/Epi_515/raw/master/epi528_missing_data_analysis_WIDE.dta"
miss.wide <- read_dta(url(link))
summary(is.na(miss.wide))
miss.wide[!complete.cases(miss.wide),]
#dummy var for missing data
miss.wide$exp_miss <- ifelse(is.na(miss.wide$cd4cnt_ph1), 1, 0)
miss.wide$out_miss <- ifelse(is.na(miss.wide$oi4), 1, 0)
#dummy var for residence
miss.wide$res_0_5 <- ifelse(miss.wide$residence==0, 1, 0)
miss.wide$res_5_10 <- ifelse(miss.wide$residence==1, 1, 0)
miss.wide$res_10_up <- ifelse(miss.wide$residence==2, 1, 0)
describe.by(miss.wide, miss.wide$oi4)
model.4 <- glm(oi4~cd4_exp1+art_base+septrin4+site+income+sex+age+residence, data=miss.wide, family=binomial)
miss.wide$cd4_exp1 <- miss.wide$cd4cnt_ph1*100
model.4 <- glm(oi4~cd4_exp1+art_base+septrin4+site+income+sex+age+residence, data=miss.wide, family=binomial)
summary(miss.wide$age)
miss.wide$age_cat[miss.wide$age<=27] <- 1
miss.wide$age_cat[miss.wide$age>27 & miss.wide$age<=32] <- 2
summary(miss.wide$age)
miss.wide$age_cat[miss.wide$age<=27] <- 1
miss.wide$age_cat[miss.wide$age>27 & miss.wide$age<=32] <- 2
miss.wide$age_cat[miss.wide$age>32 & miss.wide$age<=40] <- 3
miss.wide$age_cat[miss.wide$age>40] <- 4
model.4 <- glm(oi4~cd4cnt_ph1+art_base+septrin4+site+income+sex+age_cat+residence, data=miss.wide, family=binomial)
model.2 <- glm(oi4~cd4cnt_ph1+septrin4+art_base+income+site+age, data=miss.wide, family=binomial)
lincom(model.2)
model.2 <- glm(oi4~cd4cnt_ph1+septrin4+art_base+income+site+age_cat, data=miss.wide, family=binomial)
lincom(model.2)
model.2 <- glm(oi4~cd4cnt_ph1+septrin4+art_base+income+site+age_cat, data=miss.wide, family=binomial)
lincom(model.2)
summary(miss.wide$income)
summary(miss.wide$income)
miss.wide$income_cat[miss.wide$income<=18.75] <- 1
miss.wide$income_cat[miss.wide$income>18.75 & miss.wide$income<=26.74] <- 2
miss.wide$income_cat[miss.wide$income>26.74 & miss.wide$income<=30.50] <- 3
miss.wide$income_cat[miss.wide$income>30.50] <- 4
model.2 <- glm(oi4~cd4cnt_ph1+septrin4+art_base+income_cat+site+age_cat, data=miss.wide, family=binomial)
lincom(model.2)
model.2 <- glm(oi4~cd4cnt_ph1+septrin4+art_base+income_cat+site+age_cat+sex, data=miss.wide, family=binomial)
names(miss.wide)
names(miss.wide)
var<-c(2:9, 11, 13:14)
mice_vars <- miss.wide[,var]
names(mice_vars)
names(miss.wide)
names(miss.wide)
var<-c(2:9, 11, 13:14, 21:22)
mice_vars <- miss.wide[,var]
names(mice_vars)
names(mice_vars)
method <- c("logreg", "norm.nob", "logreg", "logreg", "norm.nob", "logreg", "logreg", "logreg", "norm.nob", "polyreg", "norm.nob", "polyreg", "polyreg")
mice <- mice(mice_vars[1:13], m=10, maxit=50, seed=135, method=method)
miss.wide$residence <- as.factor(miss.wide$residence)
miss.wide$site <- as.factor(miss.wide$site)
miss.wide$sex <- as.factor(miss.wide$sex)
miss.wide$art_base <- as.factor(miss.wide$art_base)
miss.wide$septrin1 <- as.factor(miss.wide$septrin1)
miss.wide$septrin4 <- as.factor(miss.wide$septrin4)
miss.wide$oi1 <- as.factor(miss.wide$oi1)
miss.wide$oi4 <- as.factor(miss.wide$oi4)
miss.wide$income_cat <- as.factor(miss.wide$income_cat)
miss.wide$age_cat <- as.factor(miss.wide$age_cat)
names(miss.wide)
var<-c(2:9, 11, 13:14, 21:22)
mice_vars <- miss.wide[,var]
names(mice_vars)
method <- c("logreg", "norm.nob", "logreg", "logreg", "norm.nob", "logreg", "logreg", "logreg", "norm.nob", "polyreg", "norm.nob", "polyreg", "polyreg")
mice <- mice(mice_vars[1:13], m=10, maxit=50, seed=135, method=method)
summary(mice)
names(mice_vars)
names(miss.wide)
var<-c(2:9, 11, 13:14, 21:22)
mice_vars <- miss.wide[,var]
names(mice_vars)
method <- c("logreg", "norm.nob", "logreg", "logreg", "norm.nob", "logreg", "logreg", "logreg", "norm.nob", "polyreg", "logreg", "polyreg", "polyreg")
mice <- mice(mice_vars[1:13], m=10, maxit=50, seed=135, method=method)
summary(mice)
imputed.model.mice <- glm.mids(formula=oi4~cd4cnt_ph1+art_base+septrin4+income+site+age, data=mice, family=binomial)
imputed.model.mice <- glm.mids(formula=oi4~cd4cnt_ph1+art_base+septrin4+income_cat+site+age_cat, data=mice, family=binomial)
pool <- pool(imputed.model.mice)
summary(pool)
pool <- pool(imputed.model.mice)
pool <- pool(imputed.model.mice, data=mice)
imputed.model.mice <- glm.mids(formula=oi4~cd4cnt_ph1+art_base+septrin4+income+site+age, data=mice, family=binomial)
imputed.model.mice <- glm.mids(formula=oi4~cd4cnt_ph1+art_base+septrin4+income_cat+site+age_cat, data=mice, family=binomial)
pool <- pool(imputed.model.mice)
imputed.model.mice <- glm.mids(formula=oi4~cd4cnt_ph1+art_base+septrin4+income+site+age, data=mice, family=binomial(link="logit"))
imputed.model.mice <- glm.mids(formula=oi4~cd4cnt_ph1+art_base+septrin4+income_cat+site+age_cat, data=mice, family=binomial(link="logit"))
imputed.model.mice <- glm.mids(formula=oi4~cd4cnt_ph1+art_base+septrin4+income_cat+site+age_cat, data=mice, family=binomial(link="logit"))
imputed.model.mice <- glm.mids(formula=oi4~cd4cnt_ph1+art_base+septrin4+income_cat+site+age_cat, data=mice, family=binomial)
miss.wide$residence <- as.factor(miss.wide$residence)
miss.wide$site <- as.factor(miss.wide$site)
miss.wide$sex <- as.factor(miss.wide$sex)
miss.wide$art_base <- as.factor(miss.wide$art_base)
miss.wide$septrin1 <- as.factor(miss.wide$septrin1)
miss.wide$septrin4 <- as.factor(miss.wide$septrin4)
miss.wide$oi1 <- as.factor(miss.wide$oi1)
miss.wide$oi4 <- as.factor(miss.wide$oi4)
miss.wide$income_cat <- as.factor(miss.wide$income_cat)
miss.wide$age_cat <- as.factor(miss.wide$age_cat)
#first mice model
names(miss.wide)
var<-c(2:14)
mice_vars <- miss.wide[,var]
names(mice_vars)
method <- c("logreg", "norm.nob", "logreg", "logreg", "norm.nob", "logreg", "logreg", "logreg", "norm.nob", "norm.nob", "norm.nob", "polyreg", "logreg")
mice <- mice(mice_vars[1:13], m=10, maxit=50, seed=135, method=method)
summary(mice)
mice6<-complete(mice, 6)
summary(mice)
imputed.model.mice <- glm.mids(formula=oi4~cd4cnt_ph1+art_base+septrin4+income+site+age, data=mice, family=binomial(link="logit"))
pool <- pool(imputed.model.mice)
pool <- pool(imputed.model.mice, data=mice_vars)
pool <- pool(imputed.model.mice, data=mice)
summary(pool)
summary(imputed.model.mice)
pool <- pool(data=imputed.model.mice)
summary(pool(imputed.model.mice))
pool <- pool(data=imputed.model.mice)
=======
propmiss(miss.wide)
View(miss.wide)
model.1 <- glm(oi4~cd4cnt_ph1)
model.1 <- glm(oi4~cd4cnt_ph1, data=miss.wide, family=binomial)
summary(model.1)
model.2 <- glm(oi4~cd4cnt_ph1+oi1+septrin1+septrin4+cd4cnt_ph4+site+sex+age+activity+income+residence+art_base)
model.2 <- glm(oi4~cd4cnt_ph1+oi1+septrin1+septrin4+cd4cnt_ph4+site+sex+age+activity+income+residence+art_base, data=miss.wide, family=binomial)
summary(model.2)
summary(model.1)
model.2 <- glm(oi4~cd4cnt_ph1+septrin1+septrin4+site+sex+age+activity+income+residence+art_base, data=miss.wide, family=binomial)
summary(model.2)
model.2 <- glm(oi4~cd4cnt_ph1+septrin1+site+sex+age+activity+income+residence+art_base, data=miss.wide, family=binomial)
summary(model.2)
model.2 <- glm(oi4~cd4cnt_ph1+septrin1+site+sex+age+activity+income+residence, data=miss.wide, family=binomial)
summary(model.2)
model.1 <- glm(oi4~cd4cnt_ph1, data=miss.wide, family=binomial)
summary(model.1)
model.2 <- glm(oi4~cd4cnt_ph1+septrin1+site+sex+age+activity+income+residence, data=miss.wide, family=binomial)
model.2 <- glm(oi4~cd4cnt_ph1+septrin1+site+age+income+residence, data=miss.wide, family=binomial)
summary(model.2)
model.2 <- glm(oi4~cd4cnt_ph1+septrin1+age+income+residence+site:oi4, data=miss.wide, family=binomial)
summary(model.2)
model.2 <- glm(oi4~cd4cnt_ph1+septrin1+septrin4+age+sex+income+residence+site:oi4, data=miss.wide, family=binomial)
model.2 <- glm(oi4~cd4cnt_ph1+septrin4+age+sex+income+residence+site:oi4, data=miss.wide, family=binomial)
summary(model.2)
model.2 <- glm(oi4~cd4cnt_ph1+septrin4+age+income+residence+site:oi4, data=miss.wide, family=binomial)
summary(model.2)
>>>>>>> c0a3c175c5a48070e775b5f4972beb0cbf30a491
